I"ÖÓ<blockquote>
  <p>å®ç°çº¿ç¨‹çš„æ–¹å¼ã€çº¿ç¨‹çŠ¶æ€ã€JMMæ¨¡å‹ã€Runnableä¸Callableçš„åŒºåˆ«ã€çº¿ç¨‹æ± </p>
</blockquote>

<h1 id="java-å¤šçº¿ç¨‹">Java å¤šçº¿ç¨‹</h1>

<h3 id="å®ç°çº¿ç¨‹çš„æ–¹å¼">å®ç°çº¿ç¨‹çš„æ–¹å¼</h3>

<ul>
  <li><strong>1ï¼Œç»§æ‰¿Thread</strong>
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="c1">//TODO</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ç»§æ‰¿Thread : "</span> <span class="o">+</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThread</span><span class="o">();</span>
      <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li><strong>2ï¼Œå®ç°Runnable</strong>
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyRunnable</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="c1">//TODO</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"å®ç°Runnable : "</span><span class="o">+</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">MyRunnable</span><span class="o">());</span>
      <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>**3ï¼Œå®ç°Callable<V>Â  jdk1.5ä¹‹å**
</V>    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyCallable</span> <span class="kd">implements</span> <span class="nc">Callable</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
      <span class="c1">//TODO</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"å®ç°Callable : "</span><span class="o">+</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
      <span class="k">return</span> <span class="mi">1</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ExecutionException</span><span class="o">,</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
      <span class="c1">//åˆ›å»ºMyThreadå®ä¾‹</span>
      <span class="nc">Callable</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyCallable</span><span class="o">();</span>
      <span class="c1">//è·å–FutureTask</span>
      <span class="nc">FutureTask</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">ft</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FutureTask</span><span class="o">&lt;&gt;(</span><span class="n">c</span><span class="o">);</span>
      <span class="c1">//ä½¿ç”¨FutureTaskåˆå§‹åŒ–Thread</span>
      <span class="nc">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="n">ft</span><span class="o">);</span>
      <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"è·å–call()è¿”å›å€¼ : "</span><span class="o">+</span> <span class="n">ft</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li><strong>4ï¼Œä½¿ç”¨çº¿ç¨‹æ± åˆ›å»º</strong>
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyPool</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
      <span class="n">executorService</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="nc">MyThread</span><span class="o">());</span>
      <span class="n">executorService</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="nc">MyRunnable</span><span class="o">());</span>
      <span class="nc">FutureTask</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">ft</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FutureTask</span><span class="o">&lt;&gt;(</span><span class="k">new</span> <span class="nc">MyCallable</span><span class="o">());</span>
      <span class="n">executorService</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="n">ft</span><span class="o">);</span>
      <span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="runnableä¸callableçš„åŒºåˆ«">Runnableä¸Callableçš„åŒºåˆ«</h3>

<ul>
  <li>Runnableä¸Callableéƒ½éœ€è¦è°ƒç”¨Thread.start()å¯åŠ¨çº¿ç¨‹ï¼›</li>
  <li>Runnableæ˜¯åœ¨JDK1.0çš„æ—¶å€™æå‡ºæ¥çš„å¤šçº¿ç¨‹çš„å®ç°æ¥å£ï¼Œè€ŒCallableæ˜¯åœ¨JDK1.5ä¹‹åæå‡ºçš„å¤šçº¿ç¨‹çš„å®ç°æ¥å£</li>
  <li>java.lang.Runableæ¥å£ä¹‹ä¸­åªæä¾›æœ‰ä¸€ä¸ªrun()æ–¹æ³•ï¼Œå¹¶ä¸”æ²¡æœ‰è¿”å›å€¼ï¼›</li>
  <li>
    <p>java.util.concurrent.Callableæ¥å£æä¾›call()æ–¹æ³•ï¼Œå¯ä»¥æœ‰è¿”å›å€¼ï¼›å¯ä»¥é€šè¿‡FutureTaskä¸­çš„get()æ–¹æ³•è·å–è¿”å›å€¼(<code class="language-plaintext highlighter-rouge">FutureTask.get()æ–¹æ³•å®ç°ï¼Œæ­¤æ–¹æ³•ä¼šé˜»å¡ä¸»çº¿ç¨‹ç›´åˆ°è·å–â€˜å°†æ¥â€™ç»“æœï¼›å½“ä¸è°ƒç”¨æ­¤æ–¹æ³•æ—¶ï¼Œä¸»çº¿ç¨‹ä¸ä¼šé˜»å¡ï¼</code>)</p>
  </li>
  <li>java.lang.Runableæ¥å£çš„run()æ–¹æ³•çš„å¼‚å¸¸åªèƒ½åœ¨æ–¹æ³•å†…éƒ¨å¤„ç†ï¼Œä¸èƒ½ä¸ŠæŠ›ã€‚</li>
  <li>java.util.concurrent.Callableæ¥å£æä¾›call()æ–¹æ³•å…è®¸æŠ›å‡ºå¼‚å¸¸</li>
</ul>

<p><img src="/images/2019-05-03-Java_Multiy_Thread_Basis/image01.png" alt="image01" /></p>

<h3 id="çº¿ç¨‹æ± excutorserviceä¸­çš„excutorå’Œsubmitæ–¹æ³•çš„åŒºåˆ«">çº¿ç¨‹æ± ExcutorServiceä¸­çš„excutorå’Œsubmitæ–¹æ³•çš„åŒºåˆ«</h3>

<ul>
  <li>1ã€excutoræ²¡æœ‰è¿”å›å€¼ï¼Œsubmitæœ‰è¿”å›å€¼ï¼Œå¹¶ä¸”è¿”å›æ‰§è¡Œç»“æœFutureå¯¹è±¡</li>
  <li>2ã€excutorä¸èƒ½æäº¤Callableä»»åŠ¡ï¼Œåªèƒ½æäº¤Runnableã€Threadä»»åŠ¡ï¼Œsubmitä¸¤è€…ä»»åŠ¡éƒ½å¯ä»¥æäº¤</li>
  <li>3ã€åœ¨submitä¸­æäº¤Runnableã€Threadä»»åŠ¡ï¼Œä¼šè¿”å›æ‰§è¡Œç»“æœFutureå¯¹è±¡ï¼Œä½†æ˜¯Futureè°ƒç”¨getæ–¹æ³•å°†è¿”å›nullï¼ˆRunnableæ²¡æœ‰è¿”å›å€¼ï¼‰</li>
</ul>

<h3 id="executorcompletionservice">ExecutorCompletionService</h3>

<p>å½“æˆ‘ä»¬ç”¨çº¿ç¨‹æ± submitæäº¤ä¸€ç»„å¤šçº¿ç¨‹ä»»åŠ¡ï¼Œå½“æˆ‘ä»¬éœ€è¦æ¯ä¸ªä»»åŠ¡å®Œæˆæ—¶å¹¶è·å–å®ƒçš„è¿”å›å€¼ï¼›æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é‡‡å–ï¼›ç¬¬ä¸€ç§ä½¿ç”¨Listè·å–ä¿å­˜è¿”å›å€¼ï¼Œç¬¬äºŒç§ä½¿ç”¨ExecutorCompletionServiceè·å–ä¿å­˜è¿”å›å€¼ã€‚</p>

<p><strong>ç¤ºä¾‹ä»£ç Listä¸ExecutorCompletionServiceæ¯”å¯¹</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.yeming.spring.example.thread</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.*</span><span class="o">;</span>

<span class="cm">/**
 * @author yeming.gao
 * @Description: ExecutorCompletionServiceè·å–ä¸€ç»„ä»»åŠ¡ç¤ºä¾‹
 * @date 2020/10/21 14:23
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExecutorCompletionServiceTest</span> <span class="o">{</span>

    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CallableTask</span> <span class="kd">implements</span> <span class="nc">Callable</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">i</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">CallableTask</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="nc">String</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">20000</span><span class="o">);</span>
            <span class="k">return</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"æ‰§è¡Œå®Œä»»åŠ¡ï¼š"</span> <span class="o">+</span> <span class="n">i</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">taskSize</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ExecutorService start..."</span><span class="o">);</span>
        <span class="kt">long</span> <span class="n">begin01</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="c1">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± </span>
        <span class="nc">ExecutorService</span> <span class="n">pool01</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="n">taskSize</span><span class="o">);</span>
        <span class="nc">ExecutorCompletionService</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">completionService</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ExecutorCompletionService</span><span class="o">&lt;&gt;(</span><span class="n">pool01</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">taskSize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="nc">CallableTask</span> <span class="n">callableTask</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CallableTask</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="n">completionService</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="n">callableTask</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">taskSize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">completionService</span><span class="o">.</span><span class="na">take</span><span class="o">().</span><span class="na">get</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="c1">// å…³é—­çº¿ç¨‹æ± </span>
        <span class="n">pool01</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>

        <span class="kt">long</span> <span class="n">end01</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ExecutorService end..excute timeï¼š"</span> <span class="o">+</span> <span class="o">(</span><span class="n">end01</span> <span class="o">-</span> <span class="n">begin01</span><span class="o">)</span> <span class="o">+</span> <span class="s">"ms"</span><span class="o">);</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"-------------------------------------------------------"</span><span class="o">);</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"List start..."</span><span class="o">);</span>
        <span class="kt">long</span> <span class="n">begin02</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="c1">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± </span>
        <span class="nc">ExecutorService</span> <span class="n">pool02</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="n">taskSize</span><span class="o">);</span>
        <span class="c1">// åˆ›å»ºå¤šä¸ªè¿”å›å€¼çš„ä»»åŠ¡</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">taskSize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="nc">CallableTask</span> <span class="n">callableTask</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CallableTask</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="n">pool02</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="n">callableTask</span><span class="o">);</span>
                <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">future</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">for</span> <span class="o">(</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">aList</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">aList</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="c1">// å…³é—­çº¿ç¨‹æ± </span>
        <span class="n">pool02</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>

        <span class="kt">long</span> <span class="n">end02</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"List end..excute timeï¼š"</span> <span class="o">+</span> <span class="o">(</span><span class="n">end02</span> <span class="o">-</span> <span class="n">begin02</span><span class="o">)</span> <span class="o">+</span> <span class="s">"ms"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="cm">/**
* ç¨‹åºè¿è¡Œç»“æœï¼š
*
ExecutorService start...
pool-1-thread-3æ‰§è¡Œå®Œä»»åŠ¡ï¼š3
pool-1-thread-4æ‰§è¡Œå®Œä»»åŠ¡ï¼š4
pool-1-thread-5æ‰§è¡Œå®Œä»»åŠ¡ï¼š5
pool-1-thread-2æ‰§è¡Œå®Œä»»åŠ¡ï¼š2
pool-1-thread-1æ‰§è¡Œå®Œä»»åŠ¡ï¼š1
ExecutorService end..excute timeï¼š20011ms
-------------------------------------------------------
List start...
pool-2-thread-1æ‰§è¡Œå®Œä»»åŠ¡ï¼š1
pool-2-thread-2æ‰§è¡Œå®Œä»»åŠ¡ï¼š2
pool-2-thread-3æ‰§è¡Œå®Œä»»åŠ¡ï¼š3
pool-2-thread-4æ‰§è¡Œå®Œä»»åŠ¡ï¼š4
pool-2-thread-5æ‰§è¡Œå®Œä»»åŠ¡ï¼š5
List end..excute timeï¼š20002ms
**/</span>
</code></pre></div></div>
<p>è¿™é‡Œä½¿ç”¨äº†çº¿ç¨‹æ± æé«˜äº†æ•´ä½“çš„æ‰§è¡Œæ•ˆç‡ï¼Œä½†éå†è¿™äº›Futureï¼Œè°ƒç”¨Futureæ¥å£å®ç°ç±»çš„getæ–¹æ³•æ˜¯é˜»å¡çš„ï¼Œä¹Ÿå°±æ˜¯å’Œå½“å‰è¿™ä¸ªFutureå…³è”çš„è®¡ç®—ä»»åŠ¡çœŸæ­£æ‰§è¡Œå®Œæˆçš„æ—¶å€™ï¼Œgetæ–¹æ³•æ‰è¿”å›ç»“æœï¼Œå¦‚æœå½“å‰è®¡ç®—ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œè€Œæœ‰å…¶å®ƒFutureå…³è”çš„è®¡ç®—ä»»åŠ¡å·²ç»æ‰§è¡Œå®Œæˆäº†ï¼Œå°±ä¼šç™½ç™½æµªè´¹å¾ˆå¤šç­‰å¾…çš„æ—¶é—´ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯éå†çš„æ—¶å€™è°å…ˆæ‰§è¡Œå®Œæˆå°±å…ˆè·å–å“ªä¸ªç»“æœï¼Œè¿™æ ·å°±èŠ‚çœäº†å¾ˆå¤šæŒç»­ç­‰å¾…çš„æ—¶é—´ã€‚</p>

<p>è€ŒExecutorCompletionServiceå¯ä»¥å®ç°è¿™æ ·çš„æ•ˆæœï¼Œå®ƒçš„å†…éƒ¨æœ‰ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜»å¡é˜Ÿåˆ—ï¼Œç”¨äºä¿å­˜å·²ç»æ‰§è¡Œå®Œæˆçš„Futureï¼Œé€šè¿‡è°ƒç”¨å®ƒçš„takeæ–¹æ³•æˆ–pollæ–¹æ³•å¯ä»¥è·å–åˆ°ä¸€ä¸ªå·²ç»æ‰§è¡Œå®Œæˆçš„Futureï¼Œè¿›è€Œé€šè¿‡è°ƒç”¨Futureæ¥å£å®ç°ç±»çš„getæ–¹æ³•è·å–æœ€ç»ˆçš„ç»“æœã€‚</p>

<p><strong>ExecutorCompletionServiceæ–¹æ³•è§£æ</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExecutorCompletionService</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="nc">CompletionService</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CompletionService</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nc">Future</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="nf">submit</span><span class="o">(</span><span class="nc">Callable</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">task</span><span class="o">);</span>

    <span class="nc">Future</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="nf">submit</span><span class="o">(</span><span class="nc">Runnable</span> <span class="n">task</span><span class="o">,</span> <span class="no">V</span> <span class="n">result</span><span class="o">);</span>

    <span class="nc">Future</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="nf">take</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span><span class="o">;</span>

    <span class="nc">Future</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="nf">poll</span><span class="o">();</span>

    <span class="nc">Future</span><span class="o">&lt;</span><span class="no">V</span><span class="o">&gt;</span> <span class="nf">poll</span><span class="o">(</span><span class="kt">long</span> <span class="n">timeout</span><span class="o">,</span> <span class="nc">TimeUnit</span> <span class="n">unit</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">ExecutorCompletionServiceå®ç°äº†CompletionServiceæ¥å£ï¼Œåœ¨CompletionServiceæ¥å£ä¸­å®šä¹‰äº†å¦‚ä¸‹è¿™äº›æ–¹æ³•ï¼š</code></p>

<ul>
  <li>Future<V> submit(Callable<V> task):æäº¤ä¸€ä¸ªCallableç±»å‹ä»»åŠ¡ï¼Œå¹¶è¿”å›è¯¥ä»»åŠ¡æ‰§è¡Œç»“æœå…³è”çš„Futureï¼›</V></V></li>
  <li>Future<V> submit(Runnable task,V result):æäº¤ä¸€ä¸ªRunnableç±»å‹ä»»åŠ¡ï¼Œå¹¶è¿”å›è¯¥ä»»åŠ¡æ‰§è¡Œç»“æœå…³è”çš„Futureï¼›</V></li>
  <li>Future<V> take():ä»å†…éƒ¨é˜»å¡é˜Ÿåˆ—ä¸­è·å–å¹¶ç§»é™¤ç¬¬ä¸€ä¸ªæ‰§è¡Œå®Œæˆçš„ä»»åŠ¡ï¼Œé˜»å¡ï¼Œç›´åˆ°æœ‰ä»»åŠ¡å®Œæˆï¼›</V></li>
  <li>Future<V> poll():ä»å†…éƒ¨é˜»å¡é˜Ÿåˆ—ä¸­è·å–å¹¶ç§»é™¤ç¬¬ä¸€ä¸ªæ‰§è¡Œå®Œæˆçš„ä»»åŠ¡ï¼Œè·å–ä¸åˆ°åˆ™è¿”å›nullï¼Œä¸é˜»å¡ï¼›</V></li>
  <li>Future<V> poll(long timeout, TimeUnit unit):ä»å†…éƒ¨é˜»å¡é˜Ÿåˆ—ä¸­è·å–å¹¶ç§»é™¤ç¬¬ä¸€ä¸ªæ‰§è¡Œå®Œæˆçš„ä»»åŠ¡ï¼Œé˜»å¡æ—¶é—´ä¸ºtimeoutï¼Œè·å–ä¸åˆ°åˆ™è¿”å›nullï¼›</V></li>
</ul>

<h3 id="çº¿ç¨‹çŠ¶æ€">çº¿ç¨‹çŠ¶æ€</h3>

<p>çº¿ç¨‹ä¸€å…±æœ‰å…­ç§çŠ¶æ€ï¼Œåˆ†åˆ«ä¸ºNewã€RUNNABLEã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€TERMINATEDï¼›å…·ä½“çŠ¶æ€ä¿¡æ¯å¯ä»¥çœ‹Threadç±»ä¸­çš„Stateæšä¸¾ç±»ã€‚
<code class="language-plaintext highlighter-rouge">åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ç§çŠ¶æ€ï¼Œé€šè¿‡çº¿ç¨‹çš„getStateæ–¹æ³•å¯ä»¥è·å–çº¿ç¨‹çš„çŠ¶æ€ã€‚</code></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">State</span> <span class="o">{</span>
    <span class="cm">/**
     * å½“çº¿ç¨‹è¢«åˆ›å»ºå‡ºæ¥è¿˜æ²¡æœ‰è¢«è°ƒç”¨start()æ—¶å€™çš„çŠ¶æ€
     */</span>
    <span class="no">NEW</span><span class="o">,</span>

    <span class="cm">/**
     * å½“çº¿ç¨‹è¢«è°ƒç”¨äº†start()ï¼Œä¸”å¤„äºç­‰å¾…æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºï¼ˆå¦‚CPUï¼‰ã€ç­‰å¾…IOè¿æ¥ã€æ­£åœ¨è¿è¡ŒçŠ¶æ€ï¼Œ
	 * å³è¡¨ç¤ºRunningçŠ¶æ€å’ŒReadyçŠ¶æ€ã€‚
     * 
     * æ³¨ï¼šä¸ä¸€å®šè¢«è°ƒç”¨äº†start()ç«‹åˆ»ä¼šæ”¹å˜çŠ¶æ€ï¼Œè¿˜æœ‰ä¸€äº›å‡†å¤‡å·¥ä½œï¼Œè¿™ä¸ªæ—¶å€™çš„çŠ¶æ€æ˜¯ä¸ç¡®å®šçš„ã€‚
     * 
     */</span>
    <span class="no">RUNNABLE</span><span class="o">,</span>

    <span class="cm">/**
     * ç­‰å¾…ç›‘è§†é”ï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹è¢«æ“ä½œç³»ç»ŸæŒ‚èµ·ã€‚å½“è¿›å…¥synchronizedå—/æ–¹æ³•æˆ–è€…åœ¨è°ƒç”¨wait()è¢«å”¤é†’/è¶…æ—¶ä¹‹åé‡æ–°è¿›å…¥synchronizedå—/æ–¹æ³•ï¼Œ
	 * é”è¢«å…¶å®ƒçº¿ç¨‹å æœ‰ï¼Œè¿™ä¸ªæ—¶å€™è¢«æ“ä½œç³»ç»ŸæŒ‚èµ·ï¼ŒçŠ¶æ€ä¸ºé˜»å¡çŠ¶æ€ã€‚
     * 
     * é˜»å¡çŠ¶æ€çš„çº¿ç¨‹ï¼Œå³ä½¿è°ƒç”¨interrupt()æ–¹æ³•ä¹Ÿä¸ä¼šæ”¹å˜å…¶çŠ¶æ€ã€‚
     * 
     */</span>
    <span class="no">BLOCKED</span><span class="o">,</span>

    <span class="cm">/**
     * æ— æ¡ä»¶ç­‰å¾…ï¼Œå½“çº¿ç¨‹è°ƒç”¨wait()/join()/LockSupport.park()ä¸åŠ è¶…æ—¶æ—¶é—´çš„æ–¹æ³•ä¹‹åæ‰€å¤„çš„çŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰è¢«å”¤é†’æˆ–ç­‰å¾…çš„çº¿ç¨‹æ²¡æœ‰ç»“æŸï¼Œ
	 * é‚£ä¹ˆå°†ä¸€ç›´ç­‰å¾…ï¼Œå½“å‰çŠ¶æ€çš„çº¿ç¨‹ä¸ä¼šè¢«åˆ†é…CPUèµ„æºå’ŒæŒæœ‰é”ã€‚
     * 
     */</span>
    <span class="no">WAITING</span><span class="o">,</span>

    <span class="cm">/**
     * æœ‰æ¡ä»¶çš„ç­‰å¾…ï¼Œå½“çº¿ç¨‹è°ƒç”¨sleep(ç¡çœ æ—¶é—´)/wait(ç­‰å¾…æ—¶é—´)/join(ç­‰å¾…æ—¶é—´)/ LockSupport.parkNanos(ç­‰å¾…æ—¶é—´)/LockSupport.parkUntil(ç­‰å¾…æ—¶é—´)
	 * æ–¹æ³•ä¹‹åæ‰€å¤„çš„çŠ¶æ€ï¼Œåœ¨æŒ‡å®šçš„æ—¶é—´æ²¡æœ‰è¢«å”¤é†’æˆ–è€…ç­‰å¾…çº¿ç¨‹æ²¡æœ‰ç»“æŸï¼Œä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å”¤é†’ï¼Œæ­£å¸¸é€€å‡ºã€‚
     * 
     */</span>
    <span class="no">TIMED_WAITING</span><span class="o">,</span>

    <span class="cm">/**
	 * ç»ˆæ­¢çº¿ç¨‹çš„çº¿ç¨‹çŠ¶æ€ã€‚
	 *
	 * æ‰§è¡Œå®Œäº†run()æ–¹æ³•ã€‚çº¿ç¨‹å·²å®Œæˆæ‰§è¡Œï¼›å…¶å®è¿™åªæ˜¯Javaè¯­è¨€çº§åˆ«çš„ä¸€ç§çŠ¶æ€ï¼Œåœ¨æ“ä½œç³»ç»Ÿå†…éƒ¨å¯èƒ½å·²ç»æ³¨é”€äº†ç›¸åº”çš„çº¿ç¨‹ï¼Œ
	 * æˆ–è€…å°†å®ƒå¤ç”¨ç»™å…¶ä»–éœ€è¦ä½¿ç”¨çº¿ç¨‹çš„è¯·æ±‚ï¼Œè€Œåœ¨Javaè¯­è¨€çº§åˆ«åªæ˜¯é€šè¿‡Javaä»£ç çœ‹åˆ°çš„çº¿ç¨‹çŠ¶æ€è€Œå·²ã€‚
     * 
     */</span>
    <span class="no">TERMINATED</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="å„ç§çŠ¶æ€ä¹‹é—´åˆ‡æ¢å›¾">å„ç§çŠ¶æ€ä¹‹é—´åˆ‡æ¢å›¾</h4>

<p><img src="/images/2019-05-03-Java_Multiy_Thread_Basis/image02.png" alt="image02" /></p>

<h4 id="çŠ¶æ€åˆ‡æ¢ä»£ç æ¼”ç¤º">çŠ¶æ€åˆ‡æ¢ä»£ç æ¼”ç¤º</h4>

<p><strong>NEWâ€”&gt;RUNNABLE</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">threadName</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">MyThread</span><span class="o">(</span><span class="nc">String</span> <span class="n">threadName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">=</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">getThreadName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"è°ƒç”¨çº¿ç¨‹runæ–¹æ³•--&gt;å¼€å§‹"</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">//ä¸šåŠ¡é€»è¾‘å¤„ç†</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">3000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// ä¸»åŠ¨ä¸­æ–­çº¿ç¨‹</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"è°ƒç”¨çº¿ç¨‹runæ–¹æ³•--&gt;ç»“æŸ"</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">MyThread</span> <span class="n">myThread01</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThread</span><span class="o">(</span><span class="s">"myThread01"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread01</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨start()ä¹‹å‰ state is : "</span> <span class="o">+</span> <span class="n">myThread01</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
        <span class="n">myThread01</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread01</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨start()ä¹‹å state is : "</span> <span class="o">+</span> <span class="n">myThread01</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>RUNNABLEâ€”&gt;BLOCKED</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Object</span> <span class="n">objectLock</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">MyThread</span><span class="o">(</span><span class="nc">String</span> <span class="n">threadName</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">objectLock</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">=</span> <span class="n">threadName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">objectLock</span> <span class="o">=</span> <span class="n">objectLock</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">getThreadName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"è°ƒç”¨çº¿ç¨‹runæ–¹æ³•--&gt;å¼€å§‹"</span><span class="o">);</span>
        <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">objectLock</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span><span class="o">+</span><span class="s">"è·å–synchronizedé”"</span><span class="o">);</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="c1">//ä¸šåŠ¡é€»è¾‘å¤„ç†</span>
                <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">3000</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// ä¸»åŠ¨ä¸­æ–­çº¿ç¨‹</span>
                <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"è°ƒç”¨çº¿ç¨‹runæ–¹æ³•--&gt;ç»“æŸ"</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="nc">Object</span> <span class="n">objectLock</span> <span class="o">=</span><span class="k">new</span> <span class="nc">Object</span><span class="o">();</span>
        <span class="nc">MyThread</span> <span class="n">myThread01</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThread</span><span class="o">(</span><span class="s">"myThread01"</span><span class="o">,</span><span class="n">objectLock</span><span class="o">);</span>
        <span class="nc">MyThread</span> <span class="n">myThread02</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThread</span><span class="o">(</span><span class="s">"myThread02"</span><span class="o">,</span><span class="n">objectLock</span><span class="o">);</span>
        <span class="n">myThread01</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">myThread02</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread01</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨start()ä¹‹å state is : "</span> <span class="o">+</span> <span class="n">myThread01</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread02</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨start()ä¹‹å state is : "</span> <span class="o">+</span> <span class="n">myThread02</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>RUNNABLEâ€”&gt;WAITING/TIMED_WAITING</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Object</span> <span class="n">objectLock</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">type</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">products</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="kd">private</span> <span class="nf">MyThread</span><span class="o">(</span><span class="nc">String</span> <span class="n">threadName</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">objectLock</span><span class="o">,</span> <span class="nc">String</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">=</span> <span class="n">threadName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">objectLock</span> <span class="o">=</span> <span class="n">objectLock</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">type</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">getThreadName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"è°ƒç”¨çº¿ç¨‹runæ–¹æ³•--&gt;å¼€å§‹"</span><span class="o">);</span>
        <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">objectLock</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"è·å–objectLockçš„synchronizedé”"</span><span class="o">);</span>
            <span class="c1">//ç”Ÿäº§è€…</span>
            <span class="k">if</span> <span class="o">(</span><span class="s">"Producer"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">type</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">products</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span><span class="o">);</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"ç”Ÿäº§å‡ºä¸€ä¸ªç‰©å“ï¼Œé€šçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹"</span><span class="o">);</span>
                <span class="k">this</span><span class="o">.</span><span class="na">objectLock</span><span class="o">.</span><span class="na">notify</span><span class="o">();</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"æˆåŠŸé€šçŸ¥äº†æ¶ˆè´¹è€…"</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">3000</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// ä¸»åŠ¨ä¸­æ–­çº¿ç¨‹</span>
                    <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="c1">//æ¶ˆè´¹è€…</span>
            <span class="k">if</span> <span class="o">(</span><span class="s">"Consumer"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">type</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"æ£€æŸ¥ä¸å­˜åœ¨ç‰©å“ï¼Œç­‰å¾…ç”Ÿäº§è€…ç”Ÿäº§"</span><span class="o">);</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">objectLock</span><span class="o">.</span><span class="na">wait</span><span class="o">();</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"æ”¶åˆ°æ¶ˆè´¹äº†ä¸€ä¸ªç‰©å“"</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// ä¸»åŠ¨ä¸­æ–­çº¿ç¨‹</span>
                    <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"è°ƒç”¨çº¿ç¨‹runæ–¹æ³•--&gt;ç»“æŸ"</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="nc">Object</span> <span class="n">objectLock</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">();</span>
        <span class="nc">MyThread</span> <span class="n">myThread01</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThread</span><span class="o">(</span><span class="s">"myThread01"</span><span class="o">,</span> <span class="n">objectLock</span><span class="o">,</span> <span class="s">"Consumer"</span><span class="o">);</span>
        <span class="nc">MyThread</span> <span class="n">myThread02</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThread</span><span class="o">(</span><span class="s">"myThread02"</span><span class="o">,</span> <span class="n">objectLock</span><span class="o">,</span> <span class="s">"Producer"</span><span class="o">);</span>
        <span class="n">myThread01</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread01</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨start()ä¹‹å state is : "</span> <span class="o">+</span> <span class="n">myThread01</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread01</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨objectLock.wait()ä¹‹å state is : "</span> <span class="o">+</span> <span class="n">myThread01</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
        <span class="n">myThread02</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread02</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨start()ä¹‹å state is : "</span> <span class="o">+</span> <span class="n">myThread02</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread02</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨objectLock.notify()ä¹‹å state is : "</span> <span class="o">+</span> <span class="n">myThread02</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼›åœ¨è¿™é‡Œwait/notifyå¿…é¡»å†™åœ¨synchronized ä¿æŠ¤çš„ä»£ç å—ä¸­ï¼Œåœ¨synchronizedä½¿ç”¨waitæ–¹æ³•ï¼Œè€Œåœ¨æ‰§è¡Œ wait æ–¹æ³•ä¹‹å‰ï¼Œå¿…é¡»å…ˆæŒæœ‰å¯¹è±¡çš„ monitor é”ï¼Œä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„ synchronized é”ã€‚åŸå› å°±æ˜¯ä¸ºäº†ä¿è¯ä»£ç å…ˆè¿›è¡Œwaitå†è¿›è¡Œnotifyï¼›å¦åˆ™ä¼šå‘ç”Ÿæ­»ç­‰</code></p>

<h4 id="å„ç§çŠ¶æ€åˆ‡æ¢æ–¹æ³•è¯´æ˜">å„ç§çŠ¶æ€åˆ‡æ¢æ–¹æ³•è¯´æ˜</h4>

<h5 id="waitnotifynotifyall">wait/notify/notifyAll</h5>

<p>waitæ–¹æ³•åˆ†ä¸¤ç§ï¼Œä¸€ç§æ— å‚çš„<code class="language-plaintext highlighter-rouge">wait()</code>ä¸€ç§æœ‰å‚çš„<code class="language-plaintext highlighter-rouge">wait(timeout)</code>ï¼›ä¸€ç§æ˜¯è®©çº¿ç¨‹è¿›å…¥<code class="language-plaintext highlighter-rouge">WAITING</code>ï¼›å¦ä¸€ç§æ˜¯è®©çº¿ç¨‹è¿›å…¥<code class="language-plaintext highlighter-rouge">TIMED_WAITING</code>ï¼›å¸¦å‚çš„æ˜¯è®©çº¿ç¨‹è¿›å…¥ä¸€ä¸ªæœ‰æ•ˆæœŸçš„ç­‰å¾…ï¼Œè¶…è¿‡æœ‰æ•ˆæœŸåˆ™ä¼šè‡ªåŠ¨å”¤é†’ï¼›æ— å‚çš„ä¼šè®©çº¿ç¨‹è¿›å…¥ä¸€ä¸ªæ­»ç­‰çš„çŠ¶æ€ã€‚</p>

<p>è¿™äº›æ–¹æ³•åªèƒ½ç”±åŒä¸€å¯¹è±¡é”çš„æŒæœ‰è€…çº¿ç¨‹è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯å†™åœ¨åŒæ­¥å—é‡Œé¢ï¼Œå¦åˆ™ä¼šæŠ›å‡ºIllegalMonitorStateExceptionå¼‚å¸¸ã€‚
Â  Â * waitæ–¹æ³•å¯¼è‡´å½“å‰çº¿ç¨‹ç­‰å¾…ï¼ŒåŠ å…¥è¯¥å¯¹è±¡çš„ç­‰å¾…é›†åˆä¸­ï¼Œå¹¶ä¸”æ”¾å¼ƒå½“å‰æŒæœ‰çš„å¯¹è±¡é”ã€‚
Â  Â *  notify/notifyAllæ–¹æ³•å”¤é†’ä¸€ä¸ªæˆ–æ‰€æœ‰æ­£åœ¨ç­‰å¾…è¿™ä¸ªå¯¹è±¡é”çš„çº¿ç¨‹ã€‚
Â  Â <strong>æ³¨æ„:</strong> è™½ç„¶ä¼šwaitè‡ªåŠ¨è§£é”ï¼Œä½†æ˜¯å¯¹é¡ºåºæœ‰è¦æ±‚ï¼Œå¦‚æœåœ¨notifyè¢«è°ƒç”¨ä¹‹åï¼Œæ‰å¼€å§‹waitæ–¹æ³•çš„è°ƒç”¨ï¼Œåˆ™çº¿ç¨‹ä¼šæ°¸è¿œå¤„äºwaitingçŠ¶æ€ã€‚
<strong>æ·±å…¥äº†è§£ï¼š</strong></p>
<ul>
  <li>æ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªâ€œç›‘è§†é”monitorâ€ï¼Œè¿™ä¸ªç›‘è§†å™¨ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼ˆä¸€ä¸ªç‹¬å é”ï¼Œä¸€ä¸ªå…¥å£é˜Ÿåˆ—ï¼Œä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼‰ã€‚</li>
  <li>æ³¨æ„æ˜¯ä¸€ä¸ªå¯¹è±¡åªèƒ½æœ‰ä¸€ä¸ªç‹¬å é”ï¼Œä½†æ˜¯ä»»æ„çº¿ç¨‹éƒ½å¯ä»¥æ‹¥æœ‰è¿™ä¸ªç‹¬å é”ã€‚å¯¹äºå¯¹è±¡éåŒæ­¥è€Œè¨€ï¼Œä»»æ„æ—¶åˆ»å¯ä»¥æœ‰ä»»æ„ä¸ªçº¿ç¨‹è°ƒç”¨è¯¥æ–¹æ³•ã€‚ï¼ˆå³æ™®é€šæ–¹æ³•åŒä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹è°ƒç”¨ï¼‰ã€‚å¯¹äºå¯¹è±¡è€Œè¨€ï¼Œåªæœ‰æ‹¥æœ‰è¿™ä¸ªå¯¹è±¡çš„ç‹¬å é”æ‰èƒ½è°ƒç”¨è¿™ä¸ªåŒæ­¥æ–¹æ³•ã€‚</li>
  <li>å¦‚æœè¿™ä¸ªç‹¬å é”è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªè°ƒç”¨è¯¥åŒæ­¥æ–¹æ³•çš„çº¿ç¨‹å°±ä¼šå¤„äºé˜»å¡çŠ¶æ€ï¼Œæ­¤çº¿ç¨‹è¿›å…¥å…¥å£é˜Ÿåˆ—ï¼ˆé”æ± ï¼‰ã€‚</li>
  <li>è‹¥ä¸€ä¸ªæ‹¥æœ‰è¯¥ç‹¬å é”çš„çº¿ç¨‹è°ƒç”¨è¯¥å¯¹è±¡åŒæ­¥æ–¹æ³•çš„wait()æ–¹æ³•ï¼Œåˆ™çº¿ç¨‹ä¼šé‡Šæ”¾ç‹¬å é”ï¼Œå¹¶ä¸”è¿›å…¥è¯¥çº¿ç¨‹çš„ç­‰å¾…é˜Ÿåˆ—ï¼ˆç­‰å¾…æ± ï¼‰ã€‚</li>
  <li>æŸä¸ªçº¿ç¨‹è°ƒç”¨notify(),notifyAll()æ–¹æ³•æ˜¯å°†ç­‰å¾…é˜Ÿåˆ—çš„çº¿ç¨‹è½¬ç§»åˆ°å…¥å£é˜Ÿåˆ—ï¼Œç„¶åè®©ä»–ä»¬ç«äº‰å¯¹è±¡çš„ç‹¬å é”ï¼Œå› ä¸ºè¿™ä¸ªè°ƒç”¨çº¿ç¨‹æœ¬èº«å¿…é¡»æ‹¥æœ‰é”ã€‚</li>
</ul>

<p><strong>notifyå’ŒnotifyAllçš„åŒºåˆ«</strong></p>

<p>notifyæ–¹æ³•åªå”¤é†’ä¸€ä¸ªç­‰å¾…ï¼ˆå¯¹è±¡çš„ï¼‰çº¿ç¨‹å¹¶ä½¿è¯¥çº¿ç¨‹å¼€å§‹æ‰§è¡Œã€‚æ‰€ä»¥å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹ç­‰å¾…ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªæ–¹æ³•åªä¼šå”¤é†’å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ï¼Œé€‰æ‹©å“ªä¸ªçº¿ç¨‹å–å†³äºæ“ä½œç³»ç»Ÿçš„å®ç°ã€‚å¦‚æœå½“å‰æƒ…å†µä¸‹æœ‰å¤šä¸ªçº¿ç¨‹éœ€è¦è¢«å”¤é†’ï¼Œæ¨èä½¿ç”¨notifyAllæ–¹æ³•ã€‚æ¯”å¦‚åœ¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…é‡Œé¢çš„ä½¿ç”¨ï¼Œæ¯æ¬¡éƒ½éœ€è¦å”¤é†’æ‰€æœ‰çš„æ¶ˆè´¹è€…æˆ–è€…ç”Ÿäº§è€…ï¼Œä»¥åˆ¤æ–­ç¨‹åºæ˜¯å¦å¯ä»¥ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p>

<p>notifyçš„ä¾‹å­å‰é¢å·²ç»ç»™è¿‡ä¸€ä¸ªç®€å•çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼›notifyAllçš„ä¾‹å­å…¶å®å°±æ˜¯å¤šå¢åŠ ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ç»§ç»­æŒæœ‰å¯¹è±¡é”ã€‚ç„¶åè¿›è¡Œå…¨éƒ¨å”¤é†’</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Object</span> <span class="n">objectLock</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">type</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">products</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="kd">private</span> <span class="nf">MyThread</span><span class="o">(</span><span class="nc">String</span> <span class="n">threadName</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">objectLock</span><span class="o">,</span> <span class="nc">String</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">=</span> <span class="n">threadName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">objectLock</span> <span class="o">=</span> <span class="n">objectLock</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">type</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">getThreadName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"è°ƒç”¨çº¿ç¨‹runæ–¹æ³•--&gt;å¼€å§‹"</span><span class="o">);</span>
        <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">objectLock</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"è·å–objectLockçš„synchronizedé”"</span><span class="o">);</span>
            <span class="c1">//ç”Ÿäº§è€…</span>
            <span class="k">if</span> <span class="o">(</span><span class="s">"Producer"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">type</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">products</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span><span class="o">);</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"ç”Ÿäº§å‡ºä¸€ä¸ªç‰©å“ï¼Œé€šçŸ¥æ¶ˆè´¹è€…æ¶ˆè´¹"</span><span class="o">);</span>
                <span class="k">this</span><span class="o">.</span><span class="na">objectLock</span><span class="o">.</span><span class="na">notifyAll</span><span class="o">();</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"æˆåŠŸé€šçŸ¥äº†æ¶ˆè´¹è€…"</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">3000</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// ä¸»åŠ¨ä¸­æ–­çº¿ç¨‹</span>
                    <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="c1">//æ¶ˆè´¹è€…</span>
            <span class="k">if</span> <span class="o">(</span><span class="s">"Consumer"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">type</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"æ£€æŸ¥ä¸å­˜åœ¨ç‰©å“ï¼Œç­‰å¾…ç”Ÿäº§è€…ç”Ÿäº§"</span><span class="o">);</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">objectLock</span><span class="o">.</span><span class="na">wait</span><span class="o">();</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"æ”¶åˆ°æ¶ˆè´¹äº†ä¸€ä¸ªç‰©å“"</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// ä¸»åŠ¨ä¸­æ–­çº¿ç¨‹</span>
                    <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"è°ƒç”¨çº¿ç¨‹runæ–¹æ³•--&gt;ç»“æŸ"</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="nc">Object</span> <span class="n">objectLock</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">();</span>
        <span class="nc">MyThread</span> <span class="n">myThread01</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThread</span><span class="o">(</span><span class="s">"myThread01"</span><span class="o">,</span> <span class="n">objectLock</span><span class="o">,</span> <span class="s">"Consumer"</span><span class="o">);</span>
        <span class="nc">MyThread</span> <span class="n">myThread03</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThread</span><span class="o">(</span><span class="s">"myThread03"</span><span class="o">,</span> <span class="n">objectLock</span><span class="o">,</span> <span class="s">"Consumer"</span><span class="o">);</span>

        <span class="nc">MyThread</span> <span class="n">myThread02</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThread</span><span class="o">(</span><span class="s">"myThread02"</span><span class="o">,</span> <span class="n">objectLock</span><span class="o">,</span> <span class="s">"Producer"</span><span class="o">);</span>
        <span class="n">myThread01</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">myThread03</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread01</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨start()ä¹‹å state is : "</span> <span class="o">+</span> <span class="n">myThread01</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread03</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨start()ä¹‹å state is : "</span> <span class="o">+</span> <span class="n">myThread03</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread01</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨objectLock.wait()ä¹‹å state is : "</span> <span class="o">+</span> <span class="n">myThread01</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread03</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨objectLock.wait()ä¹‹å state is : "</span> <span class="o">+</span> <span class="n">myThread03</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
        <span class="n">myThread02</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread02</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨start()ä¹‹å state is : "</span> <span class="o">+</span> <span class="n">myThread02</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread02</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨objectLock.notify()ä¹‹å state is : "</span> <span class="o">+</span> <span class="n">myThread02</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p><strong>waitï¼Œnotifyæ¥å®ç°ç­‰å¾…å”¤é†’åŠŸèƒ½æœ‰ä¸¤ä¸ªç¼ºç‚¹</strong></p>

<ul>
  <li>1.ç”±ä¸Šé¢çš„ä¾‹å­å¯çŸ¥,waitå’Œnotifyéƒ½æ˜¯Objectä¸­çš„æ–¹æ³•,åœ¨è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•å‰å¿…é¡»å…ˆè·å¾—é”å¯¹è±¡ï¼Œè¿™é™åˆ¶äº†å…¶ä½¿ç”¨åœºåˆ:åªèƒ½åœ¨åŒæ­¥ä»£ç å—ä¸­ã€‚</li>
  <li>2.å¦ä¸€ä¸ªç¼ºç‚¹å¯èƒ½ä¸Šé¢çš„ä¾‹å­ä¸å¤ªæ˜æ˜¾ï¼Œå½“å¯¹è±¡çš„ç­‰å¾…é˜Ÿåˆ—ä¸­æœ‰å¤šä¸ªçº¿ç¨‹æ—¶ï¼Œnotifyåªèƒ½éšæœºé€‰æ‹©ä¸€ä¸ªçº¿ç¨‹å”¤é†’ï¼Œæ— æ³•å”¤é†’æŒ‡å®šçš„çº¿ç¨‹ã€‚</li>
</ul>

<h5 id="ä¸ºä»€ä¹ˆ-waitnotifynotifyall-è¢«å®šä¹‰åœ¨-object-ç±»ä¸­è€Œ-sleep-å®šä¹‰åœ¨-thread-ç±»ä¸­">ä¸ºä»€ä¹ˆ wait/notify/notifyAll è¢«å®šä¹‰åœ¨ Object ç±»ä¸­ï¼Œè€Œ sleep å®šä¹‰åœ¨ Thread ç±»ä¸­ï¼Ÿ</h5>

<p>ä¸»è¦æœ‰ä¸¤ç‚¹åŸå› ï¼š</p>

<ul>
  <li>1ã€Java ä¸­æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€æŠŠç§°ä¹‹ä¸º monitor ç›‘è§†å™¨çš„é”ï¼Œç”±äºæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä¸Šé”ï¼Œè¿™å°±è¦æ±‚åœ¨å¯¹è±¡å¤´ä¸­æœ‰ä¸€ä¸ªç”¨æ¥ä¿å­˜é”ä¿¡æ¯çš„ä½ç½®ã€‚è¿™ä¸ªé”æ˜¯å¯¹è±¡çº§åˆ«çš„ï¼Œè€Œéçº¿ç¨‹çº§åˆ«çš„ï¼Œwait/notify/notifyAll ä¹Ÿéƒ½æ˜¯é”çº§åˆ«çš„æ“ä½œï¼Œå®ƒä»¬çš„é”å±äºå¯¹è±¡ï¼Œæ‰€ä»¥æŠŠå®ƒä»¬å®šä¹‰åœ¨ Object ç±»ä¸­æ˜¯æœ€åˆé€‚ï¼Œå› ä¸º Object ç±»æ˜¯æ‰€æœ‰å¯¹è±¡çš„çˆ¶ç±»ã€‚</li>
  <li>2ã€å¦‚æœæŠŠ wait/notify/notifyAll æ–¹æ³•å®šä¹‰åœ¨ Thread ç±»ä¸­ï¼Œä¼šå¸¦æ¥å¾ˆå¤§çš„å±€é™æ€§ï¼Œæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹å¯èƒ½æŒæœ‰å¤šæŠŠé”ï¼Œä»¥ä¾¿å®ç°ç›¸äº’é…åˆçš„å¤æ‚é€»è¾‘ï¼Œå‡è®¾æ­¤æ—¶ wait æ–¹æ³•å®šä¹‰åœ¨ Thread ç±»ä¸­ï¼Œå¦‚ä½•å®ç°è®©ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å¤šæŠŠé”å‘¢ï¼Ÿåˆå¦‚ä½•æ˜ç¡®çº¿ç¨‹ç­‰å¾…çš„æ˜¯å“ªæŠŠé”å‘¢ï¼Ÿæ—¢ç„¶æˆ‘ä»¬æ˜¯è®©å½“å‰çº¿ç¨‹å»ç­‰å¾…æŸä¸ªå¯¹è±¡çš„é”ï¼Œè‡ªç„¶åº”è¯¥é€šè¿‡æ“ä½œå¯¹è±¡æ¥å®ç°ï¼Œè€Œä¸æ˜¯æ“ä½œçº¿ç¨‹ã€‚</li>
</ul>

<h5 id="wait-å’Œ-sleep-æ–¹æ³•çš„å¼‚åŒ">wait å’Œ sleep æ–¹æ³•çš„å¼‚åŒï¼Ÿ</h5>

<p><strong>ç›¸åŒç‚¹</strong></p>
<ul>
  <li>1.å®ƒä»¬éƒ½å¯ä»¥è®©çº¿ç¨‹é˜»å¡ã€‚</li>
  <li>2.å®ƒä»¬éƒ½å¯ä»¥å“åº” interrupt ä¸­æ–­ï¼šåœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­å¦‚æœæ”¶åˆ°ä¸­æ–­ä¿¡å·ï¼Œéƒ½å¯ä»¥è¿›è¡Œå“åº”ï¼Œå¹¶æŠ›å‡º InterruptedException å¼‚å¸¸ã€‚</li>
</ul>

<p><strong>ä¸åŒç‚¹</strong></p>
<ul>
  <li>1.wait æ–¹æ³•å¿…é¡»åœ¨ synchronized ä¿æŠ¤çš„ä»£ç ä¸­ä½¿ç”¨ï¼Œè€Œ sleep æ–¹æ³•å¹¶æ²¡æœ‰è¿™ä¸ªè¦æ±‚ã€‚</li>
  <li>2.åœ¨åŒæ­¥ä»£ç ä¸­æ‰§è¡Œ sleep æ–¹æ³•æ—¶ï¼Œå¹¶ä¸ä¼šé‡Šæ”¾ monitor é”ï¼Œä½†æ‰§è¡Œ wait æ–¹æ³•æ—¶ä¼šä¸»åŠ¨é‡Šæ”¾ monitor é”ã€‚</li>
  <li>3.sleep æ–¹æ³•ä¸­ä¼šè¦æ±‚å¿…é¡»å®šä¹‰ä¸€ä¸ªæ—¶é—´ï¼Œæ—¶é—´åˆ°æœŸåä¼šä¸»åŠ¨æ¢å¤ï¼Œè€Œå¯¹äºæ²¡æœ‰å‚æ•°çš„ wait æ–¹æ³•è€Œè¨€ï¼Œæ„å‘³ç€æ°¸ä¹…ç­‰å¾…ï¼Œç›´åˆ°è¢«ä¸­æ–­æˆ–è¢«å”¤é†’æ‰èƒ½æ¢å¤ï¼Œå®ƒå¹¶ä¸ä¼šä¸»åŠ¨æ¢å¤ã€‚</li>
  <li>4.wait/notify æ˜¯ Object ç±»çš„æ–¹æ³•ï¼Œè€Œ sleep æ˜¯ Thread ç±»çš„æ–¹æ³•ã€‚</li>
</ul>

<h5 id="locksupport">LockSupport</h5>

<p><strong>park()/unpark(thread)</strong>
park()é˜»å¡å½“å‰çº¿ç¨‹ï¼›
unpark(thread)è§£é”æŒ‡å®šthredçº¿ç¨‹ï¼›</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">threadName</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">MyThread</span><span class="o">(</span><span class="nc">String</span> <span class="n">threadName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">=</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">getThreadName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"çº¿ç¨‹é˜»å¡--&gt;å¼€å§‹"</span><span class="o">);</span>

        <span class="nc">LockSupport</span><span class="o">.</span><span class="na">park</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"çº¿ç¨‹é˜»å¡--&gt;ç»“æŸ"</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="nc">MyThread</span> <span class="n">myThread01</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThread</span><span class="o">(</span><span class="s">"myThread01"</span><span class="o">);</span>
        <span class="n">myThread01</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread01</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"çº¿ç¨‹å”¤é†’--&gt;å¼€å§‹"</span><span class="o">);</span>
        <span class="nc">LockSupport</span><span class="o">.</span><span class="na">unpark</span><span class="o">(</span><span class="n">myThread01</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread01</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"çº¿ç¨‹å”¤é†’--&gt;ç»“æŸ"</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// ç¨‹åºè¾“å‡º</span>
<span class="n">myThread01çº¿ç¨‹é˜»å¡</span><span class="o">--&gt;</span><span class="n">å¼€å§‹</span>
<span class="n">myThread01çº¿ç¨‹å”¤é†’</span><span class="o">--&gt;</span><span class="n">å¼€å§‹</span>
<span class="n">myThread01çº¿ç¨‹å”¤é†’</span><span class="o">--&gt;</span><span class="n">ç»“æŸ</span>
<span class="n">myThread01çº¿ç¨‹é˜»å¡</span><span class="o">--&gt;</span><span class="n">ç»“æŸ</span>
</code></pre></div></div>
<p>ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚æœå”¤é†’unparkå…ˆäºé˜»å¡parkçš„æƒ…å†µ</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">threadName</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">MyThread</span><span class="o">(</span><span class="nc">String</span> <span class="n">threadName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">=</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">getThreadName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">3000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"çº¿ç¨‹é˜»å¡--&gt;å¼€å§‹"</span><span class="o">);</span>

        <span class="nc">LockSupport</span><span class="o">.</span><span class="na">park</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"çº¿ç¨‹é˜»å¡--&gt;ç»“æŸ"</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="nc">MyThread</span> <span class="n">myThread01</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThread</span><span class="o">(</span><span class="s">"myThread01"</span><span class="o">);</span>
        <span class="n">myThread01</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread01</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"çº¿ç¨‹å”¤é†’--&gt;å¼€å§‹"</span><span class="o">);</span>
        <span class="nc">LockSupport</span><span class="o">.</span><span class="na">unpark</span><span class="o">(</span><span class="n">myThread01</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread01</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"çº¿ç¨‹å”¤é†’--&gt;ç»“æŸ"</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//ç¨‹åºè¾“å‡º</span>
<span class="n">myThread01çº¿ç¨‹å”¤é†’</span><span class="o">--&gt;</span><span class="n">å¼€å§‹</span>
<span class="n">myThread01çº¿ç¨‹å”¤é†’</span><span class="o">--&gt;</span><span class="n">ç»“æŸ</span>
<span class="n">myThread01çº¿ç¨‹é˜»å¡</span><span class="o">--&gt;</span><span class="n">å¼€å§‹</span>
<span class="n">myThread01çº¿ç¨‹é˜»å¡</span><span class="o">--&gt;</span><span class="n">ç»“æŸ</span>
</code></pre></div></div>
<p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå…ˆå”¤é†’æŒ‡å®šçº¿ç¨‹,ç„¶åé˜»å¡è¯¥çº¿ç¨‹ï¼Œçº¿ç¨‹å¹¶æ²¡æœ‰çœŸæ­£è¢«é˜»å¡å¹¶ä¸”å¯ä»¥æ­£å¸¸æ‰§è¡Œå®Œåé€€å‡ºã€‚</p>

<p><code class="language-plaintext highlighter-rouge">æˆ‘ä»¬ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚æœå”¤é†’unparkä¸¤æ¬¡éƒ½å…ˆäºé˜»å¡parkä¸¤æ¬¡çš„æƒ…å†µ</code></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">threadName</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">MyThread</span><span class="o">(</span><span class="nc">String</span> <span class="n">threadName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">=</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">getThreadName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">3000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"çº¿ç¨‹é˜»å¡--&gt;å¼€å§‹"</span><span class="o">);</span>

            <span class="nc">LockSupport</span><span class="o">.</span><span class="na">park</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"çº¿ç¨‹é˜»å¡--&gt;ç»“æŸ"</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="nc">MyThread</span> <span class="n">myThread01</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThread</span><span class="o">(</span><span class="s">"myThread01"</span><span class="o">);</span>
        <span class="n">myThread01</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread01</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"çº¿ç¨‹å”¤é†’--&gt;å¼€å§‹"</span><span class="o">);</span>
            <span class="nc">LockSupport</span><span class="o">.</span><span class="na">unpark</span><span class="o">(</span><span class="n">myThread01</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread01</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"çº¿ç¨‹å”¤é†’--&gt;ç»“æŸ"</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//ç¨‹åºè¾“å‡º</span>
<span class="n">myThread01çº¿ç¨‹å”¤é†’</span><span class="o">--&gt;</span><span class="n">å¼€å§‹</span>
<span class="n">myThread01çº¿ç¨‹å”¤é†’</span><span class="o">--&gt;</span><span class="n">ç»“æŸ</span>
<span class="n">myThread01çº¿ç¨‹å”¤é†’</span><span class="o">--&gt;</span><span class="n">å¼€å§‹</span>
<span class="n">myThread01çº¿ç¨‹å”¤é†’</span><span class="o">--&gt;</span><span class="n">ç»“æŸ</span>
<span class="n">myThread01çº¿ç¨‹é˜»å¡</span><span class="o">--&gt;</span><span class="n">å¼€å§‹</span>
<span class="n">myThread01çº¿ç¨‹é˜»å¡</span><span class="o">--&gt;</span><span class="n">ç»“æŸ</span>
<span class="n">myThread01çº¿ç¨‹é˜»å¡</span><span class="o">--&gt;</span><span class="n">å¼€å§‹</span>
<span class="n">å¹¶ä¸”ç¨‹åºä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€</span>
</code></pre></div></div>
<blockquote>
  <blockquote>
    <p>ç”±æ­¤æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼šå…ˆå”¤é†’çº¿ç¨‹ï¼Œåœ¨é˜»å¡çº¿ç¨‹ï¼Œçº¿ç¨‹ä¸ä¼šçœŸçš„é˜»å¡ï¼›ä½†æ˜¯å…ˆå”¤é†’çº¿ç¨‹ä¸¤æ¬¡å†é˜»å¡ä¸¤æ¬¡æ—¶å°±ä¼šå¯¼è‡´çº¿ç¨‹çœŸçš„é˜»å¡ã€‚</p>
  </blockquote>
</blockquote>

<p><strong>park()/unpark(thread)çº¿ç¨‹é˜»å¡å”¤é†’æœºåˆ¶</strong></p>

<p>LockSupportæ˜¯é€šè¿‡æ§åˆ¶ä¸€ä¸ªå˜é‡<code class="language-plaintext highlighter-rouge">_counter</code>æ¥å¯¹çº¿ç¨‹é˜»å¡å”¤é†’è¿›è¡Œæ§åˆ¶çš„ã€‚</p>
<ul>
  <li>park()é˜»å¡çº¿ç¨‹ä¼šæ¶ˆè€—å‡­è¯ï¼Œæ­¤æ—¶ä¼šç›´æ¥å°†<code class="language-plaintext highlighter-rouge">_counter</code>è®¾ç½®ä¸º0ï¼›unpark(thread)å”¤é†’çº¿ç¨‹ä¼šè·å–ä¸€ä¸ªå‡­è¯ï¼Œæ­¤æ—¶ä¼šå°†<code class="language-plaintext highlighter-rouge">_counter</code>è®¾ç½®ä¸º1ï¼›è®°ä½è¿™ä¸ªå‡­è¯æœ€å¤šåªä¼šæœ‰1ä¸ªï¼Œå°±æ˜¯ä¸ç®¡è°ƒç”¨å‡ æ¬¡park()/unpark(thread)è¿™ä¸ªå‡­è¯è¦ä¹ˆæ˜¯1ï¼Œè¦ä¹ˆæ˜¯0ï¼›</li>
  <li>å½“è°ƒç”¨park()è¿›è¡Œé˜»å¡çº¿ç¨‹çš„æ—¶å€™ï¼Œæ­¤æ—¶ä¼šç›´æ¥å°†<code class="language-plaintext highlighter-rouge">_counter</code>è®¾ç½®ä¸º0ï¼›å³ä½¿è¿ç»­è°ƒç”¨ä¸¤æ¬¡park()ï¼Œ<code class="language-plaintext highlighter-rouge">_counter</code>ä¾æ—§æ˜¯0ï¼›åŒæ—¶ä¼šè®°å½•è®¾ç½®ä¸º0ä¹‹å‰çš„å€¼ï¼Œå‰å€¼å°äº1(ä¹Ÿå°±æ˜¯0)çš„æ—¶å€™å°±ä¼šè¿›è¡Œçº¿ç¨‹é˜»å¡ï¼›å¦åˆ™ç›´æ¥é€€å‡ºä¸è¿›è¡Œé˜»å¡ã€‚</li>
  <li>å½“è°ƒç”¨unpark(thread)è¿›è¡Œå”¤é†’çº¿ç¨‹çš„æ—¶å€™ï¼Œæ­¤æ—¶æ­¤æ—¶ä¼šç›´æ¥å°†<code class="language-plaintext highlighter-rouge">_counter</code>è®¾ç½®ä¸º1ï¼›å³ä½¿è¿ç»­è°ƒç”¨ä¸¤æ¬¡unpark(thread)ï¼Œ<code class="language-plaintext highlighter-rouge">_counter</code>ä¾æ—§æ˜¯1ï¼›åŒæ—¶ä¼šè®°å½•è®¾ç½®ä¸º1ä¹‹å‰çš„å€¼ï¼Œå‰å€¼å°äº1(ä¹Ÿå°±æ˜¯0)çš„æ—¶å€™å°±ä¼šè¿›è¡Œçº¿ç¨‹å”¤é†’ï¼›å¦åˆ™ç›´æ¥é€€å‡ºä¸è¿›è¡Œå”¤é†’ã€‚</li>
</ul>

<p>æ‰€ä»¥å°±å¯ä»¥å¾—å‡ºï¼š
<code class="language-plaintext highlighter-rouge">ä¸ºä»€ä¹ˆå¯ä»¥å…ˆå”¤é†’çº¿ç¨‹åé˜»å¡çº¿ç¨‹ï¼Ÿ</code></p>
<blockquote>
  <blockquote>
    <p>å› ä¸ºï¼šå…ˆunpark(thread)å”¤é†’çº¿ç¨‹ï¼Œ<code class="language-plaintext highlighter-rouge">_counter=1</code>ï¼›å½“park()é˜»å¡çº¿ç¨‹ï¼Œ_counter_old&gt;=1åˆ™ä¸è¿›è¡Œé˜»å¡ï¼Œç›´æ¥é€€å‡ºï¼›
<code class="language-plaintext highlighter-rouge">ä¸ºä»€ä¹ˆå”¤é†’ä¸¤æ¬¡åé˜»å¡ä¸¤æ¬¡ä¼šé˜»å¡çº¿ç¨‹ï¼Ÿ</code>
å› ä¸ºï¼šå…ˆè¿ç»­unpark(thread)å”¤é†’çº¿ç¨‹ä¸¤æ¬¡(ä¸ç®¡å¤šå°‘æ¬¡)ï¼Œ<code class="language-plaintext highlighter-rouge">_counter=1</code>ï¼›åé¢è¿ç»­ä¸¤æ¬¡park()é˜»å¡çº¿ç¨‹ï¼Œç¬¬ä¸€æ¬¡åˆ¤æ–­_counter_old&gt;=1åˆ™ä¸è¿›è¡Œé˜»å¡ï¼Œç›´æ¥é€€å‡ºï¼›åé¢ä¼šç›´æ¥è®¾ç½®<code class="language-plaintext highlighter-rouge">_counter=0</code>ï¼›ç¬¬äºŒæ¬¡åˆ¤æ–­_counter_old&gt;=1å°±ä¸æ»¡è¶³ï¼Œæ‰€ä»¥ä¼šè¿›è¡Œçº¿ç¨‹é˜»å¡ã€‚</p>
  </blockquote>
</blockquote>

<p><strong><code class="language-plaintext highlighter-rouge">æ€»ç»“ï¼šLockSupportæ˜¯JDKä¸­ç”¨æ¥å®ç°çº¿ç¨‹é˜»å¡å’Œå”¤é†’çš„å·¥å…·ã€‚ä½¿ç”¨å®ƒå¯ä»¥åœ¨ä»»ä½•åœºåˆä½¿çº¿ç¨‹é˜»å¡ï¼Œå¯ä»¥æŒ‡å®šä»»ä½•çº¿ç¨‹è¿›è¡Œå”¤é†’ï¼Œå¹¶ä¸”ä¸ç”¨æ‹…å¿ƒé˜»å¡å’Œå”¤é†’æ“ä½œçš„é¡ºåºï¼Œä½†è¦æ³¨æ„è¿ç»­å¤šæ¬¡å”¤é†’çš„æ•ˆæœå’Œä¸€æ¬¡å”¤é†’æ˜¯ä¸€æ ·çš„ã€‚LockSupportçœŸå®çš„å®ç°å‡åœ¨ unsafe</code></strong></p>

<p><strong>parkNanos(nanos)/parkUntil(deadline)</strong></p>
<ul>
  <li><strong>parkNanos(long nanos)</strong> : é˜»å¡å½“å‰çº¿ç¨‹ï¼Œæœ€é•¿ä¸è¶…è¿‡nanosçº³ç§’ï¼Œè¿”å›æ¡ä»¶åœ¨park()ä¸Šå¢åŠ äº†è¶…æ—¶æ—¶é—´</li>
  <li><strong>parkUntil(long deadline)</strong> : é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°deadlineæ—¶é—´</li>
</ul>

<p><strong>åœ¨Java6ä¸­ï¼ŒLockSupportå¢åŠ äº†3ä¸ªæ–¹æ³•ï¼š</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">park</span><span class="o">(</span><span class="nc">Object</span> <span class="n">blocker</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">parkNanos</span><span class="o">(</span><span class="nc">Object</span> <span class="n">blocker</span><span class="o">,</span> <span class="kt">long</span> <span class="n">nanos</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">parkUntil</span><span class="o">(</span><span class="nc">Object</span> <span class="n">blocker</span><span class="o">,</span> <span class="kt">long</span> <span class="n">deadline</span><span class="o">)</span>
<span class="n">å‚æ•°</span><span class="err">ï¼š</span>
			<span class="n">blocker</span><span class="err">ï¼š</span><span class="n">ç”¨æ¥æ ‡è¯†å½“å‰çº¿ç¨‹æ­£åœ¨ç­‰å¾…çš„å¯¹è±¡</span><span class="o">(</span><span class="n">å³é˜»å¡å¯¹è±¡</span><span class="o">)</span><span class="err">ï¼Œ</span><span class="n">ä¸»è¦ç”¨äºæ’æŸ¥é—®é¢˜å’Œç³»ç»Ÿç›‘æ§</span><span class="err">ã€‚</span>
	
		<span class="n">åœ¨çº¿ç¨‹dumpæ—¶</span><span class="err">ï¼Œ</span><span class="n">å¸¦blockerå‚æ•°çš„park</span><span class="o">()</span><span class="n">æ–¹æ³•æ¯”ä¸å¸¦blockerå‚æ•°çš„park</span><span class="o">()</span><span class="n">æ–¹æ³•å¤šå‡ºä»¥ä¸‹å†…å®¹</span><span class="o">(</span><span class="n">å³æŒ‡å‡ºäº†é˜»å¡å¯¹è±¡çš„ç±»å‹</span><span class="o">)</span><span class="err">ï¼š</span>
			<span class="o">-</span> <span class="n">parking</span> <span class="n">to</span> <span class="n">wait</span> <span class="k">for</span> <span class="o">&lt;</span><span class="mh">0x000</span><span class="o">...&gt;</span> <span class="err">ï¼ˆ</span> <span class="n">com</span><span class="o">.</span><span class="na">jxn</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">TestLockSupport</span><span class="err">ï¼‰</span>
			
		<span class="n">è¯´æ˜</span><span class="err">ï¼š</span>
			<span class="mi">1</span><span class="o">)</span><span class="n">å½“çº¿ç¨‹</span><span class="o">(</span><span class="n">å› ä½¿ç”¨synchronizedå…³é”®å­—</span><span class="o">)</span><span class="n">é˜»å¡åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šæ—¶</span><span class="err">ï¼Œ</span><span class="n">é€šè¿‡çº¿ç¨‹dumpèƒ½å¤ŸæŸ¥çœ‹åˆ°è¯¥çº¿ç¨‹çš„é˜»å¡å¯¹è±¡</span><span class="err">ï¼Œ</span><span class="n">ä»è€Œå¯ä»¥æ–¹ä¾¿åœ°å®šä½é—®é¢˜</span><span class="err">ã€‚</span>
			<span class="mi">2</span><span class="o">)</span><span class="n">ä½¿ç”¨LockSupportä¸­ä¸å¸¦blockerå‚æ•°çš„park</span><span class="o">()</span><span class="n">æ–¹æ³•æ¥é˜»å¡å¯¹è±¡æ—¶</span><span class="err">ï¼Œ</span><span class="n">é€šè¿‡çº¿ç¨‹dumpæ— æ³•çœ‹åˆ°è¯¥çº¿ç¨‹çš„é˜»å¡å¯¹è±¡</span><span class="err">ï¼›</span><span class="n">æ•…åœ¨java6ä¸­</span><span class="err">ï¼Œ</span><span class="n">æä¾›äº†å¸¦blockerå‚æ•°çš„park</span><span class="o">()</span><span class="n">æ–¹æ³•æ¥è§£å†³è¿™ä¸€é—®é¢˜</span><span class="err">ã€‚</span>
</code></pre></div></div>

<h5 id="join">join</h5>

<p>joinæ–¹æ³•æ˜¯å®ç°çº¿ç¨‹åŒæ­¥ï¼Œå¯ä»¥å°†åŸæœ¬å¹¶è¡Œæ‰§è¡Œçš„å¤šçº¿ç¨‹æ–¹æ³•å˜æˆä¸²è¡Œæ‰§è¡Œçš„ï¼›</p>

<p>joinæ–¹æ³•ä½¿ç”¨åœ¨çº¿ç¨‹startæ–¹æ³•ä¹‹åã€‚æ”¾åœ¨startæ–¹æ³•ä¹‹å‰åŸºæœ¬æ— ä½œç”¨ï¼Œä½†æ˜¯ä¸ä¼šæŠ¥é”™ï¼›</p>

<p>joinä¹Ÿæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯æ— å‚çš„<code class="language-plaintext highlighter-rouge">join()</code>å¦ä¸€ä¸ªæ˜¯æœ‰å‚çš„<code class="language-plaintext highlighter-rouge">join(millis)</code>ï¼›æ— å‚çš„è¡¨ç¤ºçº¿ç¨‹ä½¿ç”¨joinæ–¹æ³•ä¹‹ååœ¨æ‰§è¡Œå®Œæˆåæ‰æ‰§è¡Œä¸‹ä¸€ä¸ªçº¿ç¨‹ã€‚æœ‰å‚çš„è¡¨ç¤ºçº¿ç¨‹ä½¿ç”¨joinæ–¹æ³•ä¹‹ååœ¨æ‰§è¡ŒæŒ‡å®šæ—¶é—´ä¹‹åæ‰æ‰§è¡Œä¸‹ä¸€ä¸ªçº¿ç¨‹ã€‚å¦‚æœçº¿ç¨‹åœ¨æŒ‡å®šæ—¶é—´ä¹‹å†…æ‰§è¡Œå®Œï¼Œåˆ™çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åç»§ç»­ä¸‹ä¸€ä¸ªçº¿ç¨‹æ— éœ€ç­‰å¾…æŒ‡å®šæ—¶é—´ï¼›å¦‚æœçº¿ç¨‹åœ¨æŒ‡å®šæ—¶é—´ä¹‹å†…æœªæ‰§è¡Œå®Œï¼Œå½“æ—¶é—´åˆ°æœŸæ—¶å°±æ‰§è¡Œä¸‹ä¸€ä¸ªçº¿ç¨‹ã€‚
<strong>ç¤ºä¾‹</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">threadName</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">MyThread</span><span class="o">(</span><span class="nc">String</span> <span class="n">threadName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">=</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">getThreadName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"è°ƒç”¨çº¿ç¨‹runæ–¹æ³•--&gt;å¼€å§‹"</span><span class="o">);</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">3000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// ä¸»åŠ¨ä¸­æ–­çº¿ç¨‹</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"è°ƒç”¨çº¿ç¨‹runæ–¹æ³•--&gt;ç»“æŸ"</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="nc">MyThread</span> <span class="n">myThread01</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThread</span><span class="o">(</span><span class="s">"myThread01"</span><span class="o">);</span>
        <span class="nc">MyThread</span> <span class="n">myThread02</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThread</span><span class="o">(</span><span class="s">"myThread02"</span><span class="o">);</span>
        <span class="n">myThread01</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">myThread01</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
        <span class="n">myThread02</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread01</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨join()ä¹‹å state is : "</span> <span class="o">+</span> <span class="n">myThread01</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread02</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨start()ä¹‹å state is : "</span> <span class="o">+</span> <span class="n">myThread02</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h5 id="interrupt">interrupt</h5>

<p>interrupt()æ–¹æ³•: ä½œç”¨æ˜¯ä¸­æ–­çº¿ç¨‹ã€‚å°†ä¼šè®¾ç½®è¯¥çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ä½ï¼Œå³è®¾ç½®ä¸ºtrueï¼Œä¸­æ–­çš„ç»“æœçº¿ç¨‹æ˜¯æ­»äº¡ã€è¿˜æ˜¯ç­‰å¾…æ–°çš„ä»»åŠ¡æˆ–æ˜¯ç»§ç»­è¿è¡Œè‡³ä¸‹ä¸€æ­¥ï¼Œå°±å–å†³äºè¿™ä¸ªç¨‹åºæœ¬èº«ã€‚çº¿ç¨‹ä¼šä¸æ—¶åœ°æ£€æµ‹è¿™ä¸ªä¸­æ–­æ ‡ç¤ºä½ï¼Œä»¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦åº”è¯¥è¢«ä¸­æ–­ï¼ˆä¸­æ–­æ ‡ç¤ºå€¼æ˜¯å¦ä¸ºtrueï¼‰ã€‚å®ƒå¹¶ä¸åƒstopæ–¹æ³•é‚£æ ·ä¼šä¸­æ–­ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ã€€</p>

<p>interrupt()æ–¹æ³•åªæ˜¯æ”¹å˜ä¸­æ–­çŠ¶æ€ï¼Œä¸ä¼šä¸­æ–­ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ã€‚éœ€è¦ç”¨æˆ·è‡ªå·±å»ç›‘è§†çº¿ç¨‹çš„çŠ¶æ€ä¸ºå¹¶åšå¤„ç†ã€‚æ”¯æŒçº¿ç¨‹ä¸­æ–­çš„æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯çº¿ç¨‹ä¸­æ–­åä¼šæŠ›å‡ºinterruptedExceptionçš„æ–¹æ³•ï¼‰å°±æ˜¯åœ¨ç›‘è§†çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œä¸€æ—¦çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€è¢«ç½®ä¸ºâ€œä¸­æ–­çŠ¶æ€â€ï¼Œå°±ä¼šæŠ›å‡ºä¸­æ–­å¼‚å¸¸ã€‚è¿™ä¸€æ–¹æ³•å®é™…å®Œæˆçš„æ˜¯ï¼Œç»™å—é˜»å¡çš„çº¿ç¨‹å‘å‡ºä¸€ä¸ªä¸­æ–­ä¿¡å·ï¼Œè¿™æ ·å—é˜»çº¿ç¨‹æ£€æŸ¥åˆ°ä¸­æ–­æ ‡è¯†ï¼Œå°±å¾—ä»¥é€€å‡ºé˜»å¡çš„çŠ¶æ€ã€‚</p>

<p>æ›´ç¡®åˆ‡çš„è¯´ï¼Œå¦‚æœçº¿ç¨‹è¢«Object.wait, Thread.joinå’ŒThread.sleepä¸‰ç§æ–¹æ³•ä¹‹ä¸€é˜»å¡ï¼Œæ­¤æ—¶è°ƒç”¨è¯¥çº¿ç¨‹çš„interrupt()æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°†æŠ›å‡ºä¸€ä¸ª InterruptedExceptionä¸­æ–­å¼‚å¸¸ï¼ˆè¯¥çº¿ç¨‹å¿…é¡»äº‹å…ˆé¢„å¤‡å¥½å¤„ç†æ­¤å¼‚å¸¸ï¼‰ï¼Œä»è€Œææ—©åœ°ç»ˆç»“è¢«é˜»å¡çŠ¶æ€ã€‚å¦‚æœçº¿ç¨‹æ²¡æœ‰è¢«é˜»å¡ï¼Œè¿™æ—¶è°ƒç”¨ interrupt()å°†ä¸èµ·ä½œç”¨ï¼Œç›´åˆ°æ‰§è¡Œåˆ°wait(),sleep(),join()æ—¶,æ‰é©¬ä¸Šä¼šæŠ›å‡º InterruptedExceptionã€‚ä¹Ÿå¯ä»¥é€šè¿‡thread.isInterrupted()æ¥è·å–çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ã€‚
<strong>ç¤ºä¾‹</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">threadName</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">MyThread</span><span class="o">(</span><span class="nc">String</span> <span class="n">threadName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">=</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">getThreadName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"è°ƒç”¨çº¿ç¨‹runæ–¹æ³•--&gt;å¼€å§‹"</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">i</span><span class="o">++;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">100000000</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">" i="</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">3000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// ä¸»åŠ¨ä¸­æ–­çº¿ç¨‹</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">" çº¿ç¨‹ä¸­æ–­"</span><span class="o">);</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"è°ƒç”¨çº¿ç¨‹runæ–¹æ³•--&gt;ç»“æŸ"</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">MyThread</span> <span class="n">myThread01</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThread</span><span class="o">(</span><span class="s">"myThread01"</span><span class="o">);</span>
        <span class="n">myThread01</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">myThread01</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myThread01</span><span class="o">.</span><span class="na">getThreadName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"è°ƒç”¨interrupt()ä¹‹å state is : "</span> <span class="o">+</span> <span class="n">myThread01</span><span class="o">.</span><span class="na">getState</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h5 id="yield">yield()</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">yield</span><span class="o">();</span>
</code></pre></div></div>
<p>è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªé™æ€æœ¬åœ°æ–¹æ³•ï¼Œæ˜¯â€œè®©æ­¥â€çš„æ„æ€ï¼Œä¸»è¦æ˜¯è®©å‡ºCPUèµ„æºï¼›ä¸€æ—¦æ‰§è¡Œï¼Œå®ƒä¼šä½¿å½“å‰çº¿ç¨‹è®©å‡ºCPUï¼Œå³ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œå°±ç»ªçŠ¶æ€â€ï¼Œä»è€Œè®©å…¶å®ƒå…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„ç­‰å¾…çº¿ç¨‹è·å–æ‰§è¡Œæƒã€‚ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯è®©å‡ºCPUå¹¶ä¸ä»£è¡¨å½“å‰çº¿ç¨‹ä¸æ‰§è¡Œäº†ã€‚å½“å‰çº¿ç¨‹è®©å‡ºCPUåï¼Œè¿˜æ˜¯ä¼šè¿›è¡ŒCPUèµ„æºçš„äº‰å¤ºï¼Œä½†æ˜¯èƒ½ä¸èƒ½å†æ¬¡è¢«åˆ†é…åˆ°ï¼Œå°±ä¸ä¸€å®šäº†ã€‚å› æ­¤yeild()æ–¹æ³•çš„è°ƒç”¨å¥½åƒå°±æ˜¯åœ¨è¯´ï¼šæˆ‘å·²ç»å®Œæˆä¸€äº›æœ€ç»ˆè¦çš„å·¥ä½œäº†ï¼Œåº”è¯¥å¯ä»¥ä¼‘æ¯ä¸€ä¸‹äº†ï¼Œå¯ä»¥ç»™å…¶ä»–çº¿ç¨‹ä¸€äº›å·¥ä½œæœºä¼šäº†ï¼</p>

<p>å¦‚æœä½ è§‰å¾—ä¸€ä¸ªçº¿ç¨‹ä¸é‚£ä¹ˆé‡è¦ï¼Œæˆ–è€…ä¼˜å…ˆçº§æ¯”è¾ƒä½ï¼Œä½†æ˜¯åˆä¸æƒ³å®ƒå ç”¨è¿‡å¤šçš„CPUèµ„æºï¼Œå°±å¯ä»¥åœ¨é€‚å½“çš„æ—¶å€™ä½¿ç”¨Thread.yield()ï¼Œç»™äºˆå…¶ä»–é‡è¦çº¿ç¨‹æ›´å¤šçš„æœºä¼šã€‚</p>

<h3 id="å®ˆæŠ¤çº¿ç¨‹">å®ˆæŠ¤çº¿ç¨‹</h3>

<p>javaä¸­çº¿ç¨‹ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼šä¸€ç§æ˜¯ç”¨æˆ·çº¿ç¨‹(è¿™ä¸ªæ˜¯æˆ‘ä»¬å¹³å¸¸å¼€å‘ä¸­ç”¨åˆ°çš„)ï¼›å¦ä¸€ä¸ªå°±æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œå®ˆæŠ¤çº¿ç¨‹æˆ‘ä»¬å¯ä»¥ç®€å•çš„è®¤ä¸ºå°±æ˜¯ä¸ºäº†å®ˆæŠ¤ç”¨æˆ·çº¿ç¨‹çš„ï¼Œå½“ç„¶åŠŸèƒ½è¿œè¿œä¸æ­¢äºæ­¤ï¼›JVMæœ€å…¸å‹çš„å®ˆæŠ¤çº¿ç¨‹å°±æ˜¯GC(åƒåœ¾å›æ”¶å™¨)</p>

<p>åœ¨Threadç±»é‡Œé¢æä¾›æœ‰å¦‚ä¸‹çš„å®ˆæŠ¤çº¿ç¨‹çš„æ“ä½œæ–¹æ³•ï¼š</p>
<ul>
  <li>è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼špublic final void setDaemon(boolean on);</li>
  <li>åˆ¤æ–­æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼špublic final boolean isDaemon();</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">æ³¨æ„ï¼š</code>
<code class="language-plaintext highlighter-rouge">1ã€thread.setDaemon(true)å¿…é¡»åœ¨çº¿ç¨‹å¯åŠ¨ä¹‹å‰ï¼Œå³thread.start()æ–¹æ³•ä¹‹å‰è®¾ç½®ï¼Œå¦åˆ™ä¼šè·‘å‡ºä¸€ä¸ªIllegalThreadStateExceptionå¼‚å¸¸ã€‚å› ä¸ºæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æˆ‘ä»¬ä¸èƒ½æ”¹å˜å®ƒçš„æ€§è´¨</code>
<code class="language-plaintext highlighter-rouge">2ã€åœ¨å®ˆæŠ¤çº¿ç¨‹ä¸­æ–°å»ºå…¶å®ƒçº¿ç¨‹ä¹Ÿæ˜¯å®ˆæŠ¤çº¿ç¨‹</code>
<code class="language-plaintext highlighter-rouge">3ã€å®ˆæŠ¤çº¿ç¨‹ä¼šéšç€æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹çš„ç”¨æˆ·çº¿ç¨‹çš„ç»“æŸè€Œç»“æŸï¼›ç”¨æˆ·çº¿ç¨‹ç»“æŸé‚£ä¹ˆJVMä¹Ÿä¼šåœæ­¢å·¥ä½œï¼Œå³ä½¿å®ˆæŠ¤çº¿ç¨‹æ­£åœ¨å·¥ä½œä¹Ÿä¼šç›´æ¥ç»“æŸï¼Œæ‰€ä»¥æœ‰äº›é‡è¦çš„å¿…é¡»å®Œæˆçš„é€»è¾‘å¤„ç†ä¸åº”è¯¥æ”¾å…¥å®ˆæŠ¤çº¿ç¨‹</code></p>

<p><strong>ç¤ºä¾‹</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">threadName</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">MyThread</span><span class="o">(</span><span class="nc">String</span> <span class="n">threadName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">=</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">MyThread</span> <span class="n">myThread01</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyThread</span><span class="o">(</span><span class="s">"myThread01"</span><span class="o">);</span>
        <span class="n">myThread01</span><span class="o">.</span><span class="na">setDaemon</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">myThread01</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ç”¨æˆ·çº¿ç¨‹ç»“æŸ"</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">getThreadName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">threadName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">//å®ˆæŠ¤çº¿ç¨‹é˜»å¡2ç§’åè¿è¡Œ</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>
            <span class="nc">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"C:/Users/yeming.gao/Desktop/test.txt"</span><span class="o">);</span>
            <span class="nc">FileOutputStream</span> <span class="n">os</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="n">f</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
            <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"test"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
            <span class="n">os</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">threadName</span> <span class="o">+</span> <span class="s">"å®ˆæŠ¤çº¿ç¨‹æ‰€æœ‰ä¸šåŠ¡å¤„ç†ç»“æŸ"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="o">|</span> <span class="nc">InterruptedException</span> <span class="n">e1</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//å½“æˆ‘ä»¬æ²¡æœ‰è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹çš„æ—¶å€™ç¨‹åºè¿è¡Œçš„ç»“æœä¸ºï¼šï¼ˆå¹¶ä¸”æŒ‡å®šè·¯å¾„ä¼šå‡ºç°test.txtæ–‡ä»¶è¯´æ˜myThread01çº¿ç¨‹æ‰§è¡Œå®Œæˆï¼‰</span>
<span class="n">ç”¨æˆ·çº¿ç¨‹ç»“æŸ</span>
<span class="n">myThread01å®ˆæŠ¤çº¿ç¨‹æ‰€æœ‰ä¸šåŠ¡å¤„ç†ç»“æŸ</span>
<span class="c1">//å½“æˆ‘ä»¬è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ç¨‹åºè¿è¡Œç»“æœä¸ºï¼šï¼ˆå¹¶ä¸”æŒ‡å®šè·¯å¾„æ²¡æœ‰å‡ºç°æ–‡ä»¶ï¼Œè¯´æ˜myThread01æ²¡æœ‰æ‰§è¡Œå®Œæˆå°±å·²ç»ç»“æŸï¼‰</span>
<span class="n">ç”¨æˆ·çº¿ç¨‹ç»“æŸ</span>
</code></pre></div></div>

<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå®ˆæŠ¤çº¿ç¨‹çš„ç›®çš„æ˜¯ä¸ºäº†å®ˆæŠ¤ç”¨æˆ·çº¿ç¨‹ï¼Œå½“ç”¨æˆ·çº¿ç¨‹ç»“æŸä¹‹åï¼Œå®ˆæŠ¤çº¿ç¨‹å°±æ²¡æœ‰å­˜åœ¨çš„å¿…è¦ï¼Œæ‰€ä»¥å®ˆæŠ¤çº¿ç¨‹ä¹Ÿå°±å¯ä»¥ç›´æ¥ç»“æŸï¼›è™½ç„¶å®ˆæŠ¤çº¿ç¨‹å®é™…çš„åº”ç”¨ä¸å¤šï¼Œä½†æ˜¯é’ˆå¯¹è‡ªå·±çš„ä¸šåŠ¡æƒ…å†µæˆ–è€…åšä¸€äº›ç›‘æ§ä»€ä¹ˆçš„è¿˜æ˜¯å¯ä»¥ç”¨å¾—åˆ°çš„ã€‚</p>

<h3 id="javaçš„å†…å­˜æ¨¡å‹">Javaçš„å†…å­˜æ¨¡å‹</h3>

<p><img src="/images/2019-05-03-Java_Multiy_Thread_Basis/image03.png" alt="image03" /></p>

<p><strong>Javaå†…å­˜æ¨¡å‹-æ“ä½œè§„èŒƒï¼š</strong></p>
<ul>
  <li>1ï¼Œå…±äº«å˜é‡å¿…é¡»å­˜æ”¾åœ¨ä¸»å†…å­˜ä¸­</li>
  <li>2ï¼Œçº¿ç¨‹æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹åªå¯æ“ä½œè‡ªå·±çš„å·¥ä½œå†…å­˜</li>
  <li>3ï¼Œçº¿ç¨‹è¦æ“ä½œå…±äº«å˜é‡ï¼Œéœ€ä»ä¸»å†…å­˜ä¸­è¯»å–åˆ°å·¥ä½œå†…å­˜ï¼Œæ”¹å˜å€¼åéœ€è¦ä»å·¥ä½œå†…å­˜åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ã€‚</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">ï¼ˆå½“æ¶‰åŠå…±äº«å˜é‡çš„æ—¶å€™è¿™ä¸ªæ—¶å€™å°±ä¼šå¼•å‡ºçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼‰</code></p>

<p><strong>Javaå†…å­˜æ¨¡å‹-åŒæ­¥äº¤äº’åè®®ï¼Œè§„å®šäº†8ç§åŸå­æ“ä½œï¼š</strong></p>
<ul>
  <li>1ï¼Œlock(é”å®š)ï¼šå°†ä¸»å†…å­˜ä¸­çš„å˜é‡é”å®šï¼Œä¸ºä¸€ä¸ªçº¿ç¨‹æ‰€ç‹¬å </li>
  <li>2ï¼Œunlock(è§£é”)ï¼šå°†lockåŠ çš„é”å®šè§£é™¤ï¼Œæ­¤æ—¶å…¶å®ƒçš„çº¿ç¨‹å¯ä»¥æœ‰æœºä¼šè®¿é—®æ­¤å˜é‡</li>
  <li>3ï¼Œread(è¯»å–)ï¼šä½œç”¨äºä¸»å†…å­˜å˜é‡ï¼Œå°†ä¸»å†…å­˜ä¸­çš„å˜é‡å€¼è¯»åˆ°å·¥ä½œå†…å­˜ä¸­</li>
  <li>4ï¼Œload(è½½å…¥)ï¼šä½œç”¨äºå·¥ä½œå†…å­˜å˜é‡ï¼Œå°†readè¯»å–çš„å€¼ä¿å­˜åˆ°å·¥ä½œå†…å­˜ä¸­çš„å˜é‡å‰¯æœ¬ä¸­</li>
  <li>5ï¼Œuse(ä½¿ç”¨)ï¼šä½œç”¨äºå·¥ä½œå†…å­˜å˜é‡ï¼Œå°†å€¼ä¼ é€’ç»™çº¿ç¨‹çš„ä»£ç æ‰§è¡Œå¼•æ“</li>
  <li>6ï¼Œassign(èµ‹å€¼)ï¼šä½œç”¨äºå·¥ä½œå†…å­˜å˜é‡ï¼Œå°†æ‰§è¡Œå¼•æ“å¤„ç†è¿”å›çš„å€¼é‡æ–°èµ‹å€¼ç»™å˜é‡å‰¯æœ¬</li>
  <li>7ï¼Œstore(å­˜å‚¨)ï¼šä½œç”¨äºå·¥ä½œå†…å­˜å˜é‡ï¼Œå°†å˜é‡å‰¯æœ¬çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­</li>
  <li>8ï¼Œwrite(å†™å…¥)ï¼šä½œç”¨äºä¸»å†…å­˜å˜é‡ï¼Œå°†storeä¼ é€è¿‡æ¥çš„å€¼å†™å…¥åˆ°ä¸»å†…å­˜çš„å…±äº«å˜é‡ä¸­
åˆ©ç”¨é”çš„æœºåˆ¶=æ¥å®ç°åŒæ­¥çš„ï¼ˆè§£å†³æ•°æ®çš„ä¸ä¸€è‡´æ€§ JMMï¼‰</li>
</ul>

<h4 id="é”æœºåˆ¶æœ‰å¦‚ä¸‹ä¸¤ç§ç‰¹æ€§">é”æœºåˆ¶æœ‰å¦‚ä¸‹ä¸¤ç§ç‰¹æ€§</h4>

<ul>
  <li>äº’æ–¥æ€§ï¼šå³åœ¨åŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŒæœ‰æŸä¸ªå¯¹è±¡é”ï¼Œé€šè¿‡è¿™ç§ç‰¹æ€§æ¥å®ç°å¤šçº¿ç¨‹ä¸­çš„åè°ƒæœºåˆ¶ï¼Œè¿™æ ·åœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹éœ€è¦åŒæ­¥çš„ä»£ç å—ï¼ˆå¤åˆæ“ä½œï¼‰è¿›è¡Œè®¿é—®ã€‚äº’æ–¥æ€§æˆ‘ä»¬ä¹Ÿå¾€å¾€ç§°ä¸ºæ“ä½œçš„åŸå­æ€§ã€‚</li>
  <li>å¯è§æ€§ï¼šå¿…é¡»ç¡®ä¿åœ¨é”è¢«é‡Šæ”¾ä¹‹å‰ï¼Œå¯¹å…±äº«å˜é‡æ‰€åšçš„ä¿®æ”¹ï¼Œå¯¹äºéšåè·å¾—è¯¥é”çš„å¦ä¸€ä¸ªçº¿ç¨‹æ˜¯å¯è§çš„ï¼ˆå³åœ¨è·å¾—é”æ—¶åº”è·å¾—æœ€æ–°å…±äº«å˜é‡çš„å€¼ï¼‰ï¼Œå¦åˆ™å¦ä¸€ä¸ªçº¿ç¨‹å¯èƒ½æ˜¯åœ¨æœ¬åœ°ç¼“å­˜çš„æŸä¸ªå‰¯æœ¬ä¸Šç»§ç»­æ“ä½œä»è€Œå¼•èµ·çš„ä¸ä¸€è‡´
ï¼ˆåå‘é”â€”&gt;è‡ªæ—‹é”â€”&gt;è½»é‡çº§é”â€”&gt;é‡é‡çº§é”ï¼‰</li>
</ul>

<h4 id="é”ä¼˜åŒ–æ–¹æ³•">é”ä¼˜åŒ–æ–¹æ³•</h4>
<ul>
  <li>1ï¼Œå‡å°‘é”æŒæœ‰æ—¶é—´</li>
  <li>2ï¼Œå‡å°é”ç²’åº¦</li>
  <li>3ï¼Œé”åˆ†ç¦»</li>
  <li>4ï¼Œé”ç²—åŒ–</li>
  <li>5ï¼Œé”æ¶ˆé™¤</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">é”è¿™å—ä¹Ÿåªæ˜¯å…ˆäº†è§£è¿™äº›æ¦‚å¿µï¼Œåç»­å†å­¦ä¹ æ›´æ–°</code></p>
:ET